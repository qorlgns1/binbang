version: "1.1"
last_verified: "2026-02-15"
service:
  name: "binbang"
  purpose: "Airbnb/Agoda accommodation availability monitoring and notification service"
  criticality: "high"

owners:
  primary: "KIHOON BAE"
  secondary: "없음"
  oncall_channel: "github:issues"

environments:
  dev:
    url: "https://dev-binbang.moodybeard.com"
    deploy_trigger: "GitHub Actions deploy.yml on push to develop"
    branch_or_tag: "develop"
  staging:
    url: "N/A"
    deploy_trigger: "N/A"
    branch_or_tag: "N/A"
  production:
    url: "https://binbang.moodybeard.com"
    deploy_trigger: "GitHub Actions deploy.yml on push to main"
    branch_or_tag: "main"

infrastructure:
  compute: "OCI VM + Docker Compose"
  region: "ap-seoul-1"
  runtime: "Node.js 24.x, pnpm 10.28.0"
  database: "PostgreSQL (external, DATABASE_URL)"
  cache: "Redis 7"
  storage: "사용 안 함"
  ingress: "Nginx reverse proxy + Let's Encrypt"

deployment:
  pipeline_steps:
    - "validate (lint/format/test/build)"
    - "build and push Docker images"
    - "SSH deploy on target host"
    - "prisma migrate deploy + generate"
    - "compose up -d"
  deploy_commands:
    - "docker compose -f docker/docker-compose.production.yml --env-file .env.production pull"
    - "pnpm with-env:production:host pnpm --filter @workspace/db exec prisma migrate deploy"
    - "docker compose -f docker/docker-compose.production.yml --env-file .env.production up -d"
  smoke_checks:
    - "curl -fsS https://binbang.moodybeard.com/api/health"
    - "docker compose -f docker/docker-compose.production.yml --env-file .env.production ps"

migration:
  tool: "Prisma Migrate"
  strategy: "deploy migration before final service up"
  command: "pnpm --filter @workspace/db exec prisma migrate deploy"

rollback:
  app_command: "Reset IMAGE_TAG/IMAGE_*_DIGEST in .env.production to previous known-good values and run compose pull/up"
  db_command: "Use migration-specific rollback SQL or fix-forward (no generic automatic down migration)"
  verification:
    - "GET /api/health returns 200"
    - "web/worker logs show no startup errors"

config:
  required_env_vars:
    - "APP_ENV"
    - "DATABASE_URL"
    - "REDIS_URL"
    - "NEXTAUTH_URL"
    - "NEXTAUTH_SECRET"
    - "GOOGLE_CLIENT_ID"
    - "GOOGLE_CLIENT_SECRET"
    - "KAKAO_CLIENT_ID"
    - "KAKAO_CLIENT_SECRET"
    - "WORKER_INTERNAL_URL"
    - "IMAGE_TAG"
    - "IMAGE_WEB_DIGEST"
    - "IMAGE_WORKER_DIGEST"
  secret_manager:
    provider: "GitHub Actions Secrets + server .env files"
    path_prefix: "N/A"
  notes: "Never include secret values in docs or prompts."

observability:
  logs: "docker compose logs (web/worker/redis)"
  metrics: "https://binbang.moodybeard.com/admin/monitoring, https://binbang.moodybeard.com/admin/throughput, https://binbang.moodybeard.com/admin/heartbeat"
  traces: "없음"
  alerts: "github:issues"

llm_operating_rules:
  - "Do not guess missing values; ask follow-up questions."
  - "For production changes, always present a preflight checklist first."
  - "Always include rollback steps with deploy guidance."
  - "Use DEPLOYMENT.md, ENVIRONMENTS.md, and RUNBOOK.md as source of truth before suggesting commands."
